spring:
  application:
    name: pms-rttm

  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:pmsdb}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: ${DB_DRIVER:org.postgresql.Driver}

  data:
    redis:
      timeout: ${REDIS_TIMEOUT:2s}
      password: ${REDIS_PASSWORD:}
      
      # Redis Sentinel configuration
      sentinel:
        master: ${REDIS_SENTINEL_MASTER:mymaster}
        nodes: ${REDIS_SENTINEL_NODES:sentinel-1:26379,sentinel-2:26379,sentinel-3:26379}
        password: ${REDIS_SENTINEL_PASSWORD:}
  cache:
    type: ${CACHE_TYPE:redis}

  docker:
    compose:
      enabled: false
      
  jpa:
    hibernate:
      ddl-auto: ${DB_DDL_AUTO:validate}
    show-sql: ${DB_SHOW_SQL:false}
    open-in-view: ${JPA_OPEN_IN_VIEW:false}
    properties:
      hibernate:
        format_sql: ${DB_FORMAT_SQL:true}
        dialect: ${DB_DIALECT:org.hibernate.dialect.PostgreSQLDialect}
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS}
    consumer:
      group-id: ${KAFKA_CONSUMER_GROUP_ID}

schema:
  registry:
    url: ${SCHEMA_REGISTRY_URL}

server:
  port: ${SERVER_PORT:8087}  


logging:
  level:
    com.pms.rttm: DEBUG


kafka:
  topics:
    dlq-events: ${KAFKA_TOPIC_DLQ_EVENTS:rttm.dlq.events}
    error-events: ${KAFKA_TOPIC_ERROR_EVENTS:rttm.error.events}
    queue-metrics: ${KAFKA_TOPIC_QUEUE_METRICS:rttm.queue.metrics}
    trade-events: ${KAFKA_TOPIC_TRADE_EVENTS:rttm.trade.events}
    invalid-trades: ${KAFKA_TOPIC_INVALID_TRADES:invalid-trades-topic}

# RTTM batching and queue settings
rttm:
  batch:
    size: ${RTTM_BATCH_SIZE:100}
    poll-ms: ${RTTM_BATCH_POLL_MS:2000}
  queue:
    capacity: ${RTTM_QUEUE_CAPACITY:10000}
  consumer:
    concurrency: ${RTTM_CONSUMER_CONCURRENCY:3}
  fetch:
    max-wait-ms: ${RTTM_FETCH_MAX_WAIT_MS:3000}
  
  # Queue metrics retention and aggregation (reduces massive data growth)
  queue-metrics:
    retention-hours: ${RTTM_QUEUE_METRICS_RETENTION_HOURS:48}      # Keep last 48 hours in DB
    cleanup-cron: ${RTTM_QUEUE_METRICS_CLEANUP_CRON:0 0 2 * * ?}   # Daily DB cleanup at 2 AM
    aggregation-threshold: ${RTTM_QUEUE_METRICS_AGG_THRESHOLD:0.1} # Store if lag changes >10%
    min-interval-minutes: ${RTTM_QUEUE_METRICS_MIN_INTERVAL:5}     # Or 5 minutes elapsed
    cache-ttl-hours: ${RTTM_QUEUE_METRICS_CACHE_TTL_HOURS:24}      # Redis TTL (auto-expires old entries)
  
  # Alert generation thresholds
  alerts:
    # Evaluation runs every minute by default
    evaluation-interval-ms: ${RTTM_ALERT_EVAL_INTERVAL:60000}
    
    # Auto-resolve stale alerts every 5 minutes
    auto-resolve-interval-ms: ${RTTM_ALERT_AUTO_RESOLVE_INTERVAL:300000}
    
    # Latency thresholds (milliseconds) - VERY LOW FOR DEV/TESTING
    latency:
      warning:
        ms: ${RTTM_ALERT_LATENCY_WARNING:50}
      critical:
        ms: ${RTTM_ALERT_LATENCY_CRITICAL:200}
    
    # Error rate thresholds (count in 5 minutes) - VERY LOW FOR DEV/TESTING
    error-rate:
      warning: ${RTTM_ALERT_ERROR_RATE_WARNING:1}
      critical: ${RTTM_ALERT_ERROR_RATE_CRITICAL:2}
    
    # DLQ count thresholds (count in 5 minutes) - VERY LOW FOR DEV/TESTING
    dlq:
      warning: ${RTTM_ALERT_DLQ_WARNING:1}
      critical: ${RTTM_ALERT_DLQ_CRITICAL:2}
    
    # Queue depth thresholds - VERY LOW FOR DEV/TESTING
    queue-depth:
      warning: ${RTTM_ALERT_QUEUE_DEPTH_WARNING:10}
      critical: ${RTTM_ALERT_QUEUE_DEPTH_CRITICAL:50}
    
    # TPS (transactions per second) thresholds - VERY LOW FOR DEV/TESTING
    tps:
      warning: ${RTTM_ALERT_TPS_WARNING:10}
      critical: ${RTTM_ALERT_TPS_CRITICAL:50}